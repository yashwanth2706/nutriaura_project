<!-- Product Detail View using Alpine.js -->
<div id="product-detail-container" x-data="productDetailView()" x-cloak>
  
  <!-- Product Detail Content (Only shown when a product is selected) -->
  <template x-if="selectedProduct">
    <section class="container my-5">
      <div class="row g-4 mb-5">
        <!-- Left Side: Product Card -->
        <div class="col-lg-5">
          <div class="card h-100 shadow-sm border-0">
            <div class="position-relative">
              <span class="badge position-absolute top-0 start-0 m-3 px-3 py-2" 
                    :style="{ backgroundColor: selectedProduct.badgeColor }" style="z-index: 5;">
                <span x-text="selectedProduct.badge"></span>
              </span>
              <button class="btn btn-light position-absolute top-0 end-0 m-3 rounded-circle p-2" 
                      style="width: 36px; height: 36px; z-index: 5;">
                <i class="bi bi-heart"></i>
              </button>
              <img :src="'/static/images/' + selectedProduct.image" :alt="selectedProduct.name" 
                   class="card-img-top" style="height: 400px; object-fit: cover;">
            </div>
            <div class="card-body d-flex flex-column">
              <h5 class="card-title fw-semibold mb-2" x-text="selectedProduct.name"></h5>
              <p class="text-muted small mb-2" x-text="selectedProduct.category"></p>
              <div class="d-flex align-items-center mb-3">
                <span class="text-warning me-1">★★★★★</span>
                <span class="fw-semibold me-1" x-text="selectedProduct.rating"></span>
                <span class="text-muted small" x-text="selectedProduct.reviews"></span>
              </div>
              <div class="mb-3">
                <h4 class="mb-0 fw-bold">₹<span x-text="selectedProduct.price"></span></h4>
              </div>
              <select class="form-select mb-3" x-model="selectedSize">
                <template x-for="size in selectedProduct.sizes" :key="size">
                  <option :value="size" x-text="size"></option>
                </template>
              </select>
              <button class="btn text-white fw-semibold py-2 mt-auto" style="background-color: #2d5f2e;">
                ADD TO CART
              </button>
            </div>
          </div>
        </div>

        <!-- Right Side: Product Details with Lorem Ipsum -->
        <div class="col-lg-7">
          <div class="product-details-content">
            <h2 class="mb-4 fw-bold" x-text="selectedProduct.name"></h2>
            
            <!-- Rating -->
            <div class="d-flex align-items-center mb-4">
              <span class="text-warning me-2">★★★★★</span>
              <span class="fw-semibold me-2" x-text="selectedProduct.rating"></span>
              <span class="text-muted" x-text="selectedProduct.reviews"></span>
            </div>

            <!-- Price -->
            <div class="mb-4">
              <h3 class="fw-bold text-success mb-2">₹<span x-text="selectedProduct.price"></span></h3>
              <p class="text-muted">Category: <span x-text="selectedProduct.category"></span></p>
            </div>

            <!-- Description -->
            <div class="mb-4">
              <h5 class="fw-semibold mb-2">Description</h5>
              <p class="text-muted">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
              </p>
            </div>

            <!-- Details/Specifications -->
            <div class="mb-4">
              <h5 class="fw-semibold mb-2">Product Details</h5>
              <p class="text-muted">
                Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
              </p>
            </div>

            <!-- Recipe/Usage Instructions -->
            <div class="mb-4">
              <h5 class="fw-semibold mb-2">How to Use</h5>
              <p class="text-muted">
                Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.
              </p>
            </div>

            <!-- Additional Information -->
            <div class="mb-4">
              <h5 class="fw-semibold mb-2">Additional Information</h5>
              <p class="text-muted">
                Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.
              </p>
            </div>

            <!-- Close Button -->
            <button @click="clearSelection()" class="btn btn-outline-secondary w-100">
              Back to All Products
            </button>
          </div>
        </div>
      </div>
    </section>
  </template>
</div>

<script>
  function productDetailView() {
    return {
      selectedProduct: null,
      selectedSize: '',
      
      selectProduct(product) {
        this.selectedProduct = { ...product };
        this.selectedSize = product.sizes[0] || '';
        // Hide carousel
        const carousel = document.getElementById('carouselExampleIndicators');
        if (carousel) carousel.style.display = 'none';
        window.scrollTo(0, 0);
      },
      
      clearSelection() {
        this.selectedProduct = null;
        this.selectedSize = '';
        // Show carousel
        const carousel = document.getElementById('carouselExampleIndicators');
        if (carousel) carousel.style.display = 'block';
      },

      init() {
        // Listen for product selection event from products.js
        document.addEventListener('productSelected', (e) => {
          this.selectProduct(e.detail);
        });
      }
    }
  }

  // Initialize when Alpine.js is ready
  document.addEventListener('alpine:init', () => {
    const container = document.getElementById('product-detail-container');
    if (container && container.__x) {
      container.__x.init();
    }
  });

  // Also try to initialize after a short delay for Alpine.js
  setTimeout(() => {
    const container = document.getElementById('product-detail-container');
    if (container && container.__x) {
      container.__x.init();
    }
  }, 100);
</script>
